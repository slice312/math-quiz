(()=>{"use strict";const e={playerName:"",gameMode:"",score:0,level:1,correctCount:0,incorrectCount:0};!e.playerName&&window.AppState&&(e.playerName=window.AppState.playerName),window.AppState=e;const t=(e,t)=>String(e).padStart(t,"0"),n=(e,t)=>Math.round(Math.random()*(t-e)+e);class o{#e;#t;#n;#o;#a;set onTick(e){this.#e=e}set onComplete(e){this.#t=e}start(e){this.#o=this.#n=e,this.#r(),this.#a=setInterval(this.#r.bind(this),1e3)}stop(){clearInterval(this.#a),this.#t?.()}#r(){this.#o<=0?this.stop():(this.#o-=1,this.#e?.(this.#o,this.#n))}}class a{static#s=["+","-","*","/"];#l;generateExpression(){const e=n(1,10),t=n(1,10),o=a.#s[n(0,3)];return{num1:e,num2:t,operator:o,result:this.getResult(e,t,o)}}getResult(e,t,n){switch(n){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t;default:throw new Error(`Unexpected operator: ${n}`)}}}const r=t=>{const n=document.getElementById("modal-game-result"),o=document.getElementById("modal-order-container");n.style.display="block",(()=>{const t={level:document.getElementById("modal-game-result-level"),score:document.getElementById("modal-game-result-score"),correct:document.getElementById("modal-game-result-correct-count"),incorrect:document.getElementById("modal-game-result-incorrect-count")};t.level.textContent=String(e.level),t.score.textContent=String(e.score),t.correct.textContent=String(e.correctCount),t.incorrect.textContent=String(e.incorrectCount)})(),document.getElementById("btn-play-again").onclick=()=>{o.classList.add("animate__zoomOut"),o.onanimationstart=()=>{n.style.background="transparent"},o.onanimationend=()=>{n.style.display="none",o.classList.remove("animate__zoomOut"),o.onanimationend=null},t?.()}};let s,l,i;const c=()=>{m(),s.start(15);let e=d();i.onsubmit=t=>{t.preventDefault(),i.elements.result.value&&(Number(i.elements.result.value)===e.result?g():p(),e=d())}},m=()=>{e.level=1,document.getElementById("game-screen-level-label").textContent=String(e.level),e.score=0,h(!1),e.correctCount=0,e.incorrectCount=0},d=()=>{const e=document.getElementById("game-screen-expr-wrap");e.classList.add("animate__fadeOutLeft"),window.requestAnimationFrame((()=>{e.classList.remove("animate__fadeOutLeft"),i.elements.result.value=""}));const t=l.generateExpression();return u(t),t},u=e=>{const t=document.getElementById("game-screen-ex-left"),n=document.getElementById("game-screen-ex-op"),o=document.getElementById("game-screen-ex-right");t.textContent=e.num1,n.textContent=e.operator,o.textContent=e.num2},g=()=>{e.score+=1,e.correctCount+=1;const t=document.getElementById("game-screen-score-label-plus");t.classList.add("label_lift-up"),t.onanimationend=()=>{t.classList.remove("label_lift-up"),t.onanimationend=null},h(!1)},p=()=>{e.score=Math.max(e.score-1,0),e.incorrectCount+=1;const t=document.getElementById("game-screen-score-label-minus");t.classList.add("label_lift-up"),t.onanimationend=()=>{t.classList.remove("label_lift-up"),t.onanimationend=null},h(!0)},h=t=>{if(t){const e=document.getElementById("game-screen-score-label");e.classList.add("animate__shakeX"),e.onanimationend=()=>{e.classList.remove("animate__shakeX"),e.onanimationend=null}}document.getElementById("game-screen-score-value").textContent=String(e.score)},y={404:{template:"./src/templates/404.html",render:null,title:"",description:""},"/":{template:"./src/templates/main-menu.html",render:()=>{const t=document.getElementById("main-menu");document.getElementById("main-menu-btn-play").onclick=n=>{e.gameMode=t.elements.gameMode.value,e.playerName=t.elements.name.value,console.log("GLOBAL state",e),t.checkValidity()&&(n.preventDefault(),v.navigate("main-game-screen"))}},title:"",description:""},"/about":{template:"./src/templates/about.html",render:()=>{console.log("renderAboutPage")},title:"",description:""},"/main-game-screen":{template:"./src/templates/main-game-screen.html",render:()=>{s=(()=>{const e=document.getElementById("game-screen-timer-label"),n=document.getElementById("game-screen-timer-circle"),a=2*n.getAttribute("r")*Math.PI;n.setAttribute("stroke-dasharray",String(a));const s=new o;s.onTick=(e,t)=>{l(e),n.setAttribute("stroke-dashoffset",String(a*e/t-a))};const l=n=>{const o=t(Math.floor(n/60),2),a=t(n%60,2);e.textContent=`${o}:${a}`};return s.onComplete=()=>{r((()=>c()))},s})(),l=new a,i=document.getElementById("game-screen-task-form"),document.getElementById("game-screen-player-name").textContent=e.playerName,document.getElementById("game-screen-btn-stop").onclick=()=>s.stop(),c()},title:"Quiz",description:""},"/leaderboard":{template:"./src/templates/leaderboard.html",render:null,title:"Leaderboard",description:""}},v=new class{#i;constructor(e){this.#i=e}init(){const e=e=>this.#c(e);window.addEventListener("popstate",e),window.addEventListener("hashchange",e),window.addEventListener("load",e)}#c(e){e.preventDefault(),window.history.pushState({},"",e.target.href),this.#m()}async#m(){console.log("URL Handler");const e=this.getCurrentUrlPath(),t=this.#i[e],n=await fetch(t.template).then((e=>e.text())),o=(new DOMParser).parseFromString(n,"text/html"),a=document.getElementById("root");this.#d(a);for(const e of o.body.childNodes)a.appendChild(e);t.render&&t.render()}getCurrentUrlPath(){const e=window.location.pathname;return e.indexOf("/zeon-module-2_MathQuiz")>=0?e.replace("/zeon-module-2_MathQuiz",""):e}#d=e=>{for(;e.lastChild;)e.removeChild(e.lastChild)};navigate(e){window.history.pushState({},"",e),this.#m()}}(y);class C extends HTMLElement{connectedCallback(){this.addEventListener("click",(()=>{const e=this.getAttribute("href");v.navigate(e)}),!1)}}console.log("PAGE LOADING"),document.addEventListener("DOMContentLoaded",(()=>{v.init(),window.customElements.define("app-link",C)}))})();